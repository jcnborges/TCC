\chapter{Fundamentação Teórica}

Este capítulo apresentará a fundamentação teórica desse trabalho de conclusão de curso. Será descrito o estado inicial em que se encontrava o projeto do robô Bellator, com uma visão geral deste ao ser entregue à equipe, a especificação do robô após a reconstrução, a apresentação da Lógica Fuzzy e da metodologia de Mapas Cognitivos Fuzzy (FCM).

%---------- Estado inicial do Projeto ----------
\section{Estado Inicial do Projeto}
\label{chap:estpro}

Esta seção visa descrever com quais recursos a equipe iniciou a execução do trabalho, tanto físicos como lógicos, ou seja, a situação do robô e seus componentes de hardware, o principal recurso material disponível, os componentes de software e a documentação de ambos, da forma como foi entregue à equipe.

\subsection{Visão Geral}

O robô disponibilizado à equipe para a realização desse trabalho, o Bellator, é resultado de um projeto não concluído, visando a implementação de uma plataforma robótica controlada remotamente por joystick. Para tal, o robô foi dividido em três camadas: baixo nível, alto nível e supervisório. A camada de baixo nível seria responsável por controlar os motores do robô, bem como receber leituras dos sensores do mesmo. A camada de alto nível comunicar-se-ia com a camada de baixo nível via conexão serial, faria obtenção de vídeo através de uma webcam e comunicar-se-ia com a camada supervisória através de uma conexão sem fio. Esta última seria a interface com o usuário para realizar o controle remoto do robô. O diagrama esquemático da figura \ref{fig:diagsis} demonstra essa situação.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=\textwidth]{./figs/diagsis.png}
	\caption[Diagrama original do Bellator]{Diagrama original do projeto Bellator, retirado da monografia do mesmo.}
	\fonte{\cite{BELLATOR}}
	\label{fig:diagsis}
\end{figure}

A partir da figura \ref{fig:diagsis}, o funcionamento do projeto Bellator pode ser explicado. A camada de baixo nível é composta pelo robô Bellator, equipado com dois motores elétricos Bosch FPG 12V, seis sensores de distância "2Y0A02F98" da Sharp, uma bateria Unybatt 12V-7,2 Ampére hora, duas pontes H e a placa microcontrolada C8051F340, capaz de ler e converter leituras de tensão analógicas dos sensores do robô bem como produzir sinais de controle para os motores do robô. Esta placa está conectada à camada de alto nível, composta por um PC Embarcado VIA EPIA ME60000 Mini-ITX com sistema operacional Linux, através de uma conexão serial. Utilizando-se de um protocolo de comunicação, esse PC embarcado envia comandos de movimentação para a camada de baixo nível e recebe as leituras dos sensores obtidas pela camada de baixo nível. O PC embarcado também comunica-se com a camada de alto nível para receber comandos de movimentação do usuário e enviar as leituras dos sensores para o mesmo. Além disso, o PC embarcado envia, também via comunicação sem fio, um stream de vídeo gerado por uma webcam Genius iLook 316. Finalmente, o software supervisor remoto, executado em um PC com máquina virtual Java, fornece as informações recebidas da camada de alto nível para o usuário, permitindo-o tomar decisões sobre a locomoção do robô. O software também recebe comandos de movimentação do usuário, gerados em um Joystick do videogame Sony Playstation 2, enviando-os para a camada de alto nível pela mesma conexão.

O leitor pode observar que o projeto Bellator apresenta objetivos muito distintos do projeto "Algoritmos de Navegação Fuzzy: Uma Análise Qualitativa". Assim, não será feita uma descrição detalhada de todos os componentes do projeto Bellator. A seguir, será descrito como o robô foi recebido pela equipe e quais componentes foram reaproveitados.

\subsection{Recebimento do Robô}
\label{sec:recrobo}

O robô Bellator foi entregue à equipe em Abril de 2011, em uma caixa, desmontado, juntamente com toda a documentação disponível por mídia digital. A caixa continha os seguintes itens:

\begin{itemize}
\item Chassi do robô Bellator com dois motores Bosch FPG12V e pontes H acoplados;
\item Cinco sensores de distância "2Y0A02F98" da Sharp;
\item Duas baterias Unybatt 12V-7,2 Ampére hora;
\item Uma placa micro-controlada C8051F340;
\item Uma placa de roteamento, produzida pelo projeto Bellator;
\item Um PC Embarcado VIA EPIA ME60000 Mini-ITX.
\end{itemize}

O chassi do robô e seus componentes acoplados são a base da plataforma robótica a ser utilizada pela equipe e são críticas para a execução desse trabalho. Os sensores de distância, um a menos que os disponíveis no projeto Bellator, são essenciais para a localização do robô e de obstáculos. A placa microcontrolada também é um recurso crítico, pois é o componente responsável por todo o controle de baixo nível do robô cujo software e a documentação serão reaproveitados do projeto Bellator. As baterias são um recurso necessário e de fácil aquisição, ao contrário dos outros componentes citados.

Alguns itens mencionados na seção anterior, referentes ao projeto Bellator, não foram recebidos ou não serão utilizados nesse trabalho. A webcam e joystick não foram entregues pois não serão necessários, visto que um sistema de navegação autônomo não necessita de joystick e esse trabalho não abordará navegação através de imagem de vídeo. A placa de roteamento entregue será utilizada nos testes dos componentes, visto que é essencial para o funcionamento do robô. Esta placa será reprojetada e reconstruída. O PC embarcado foi entregue destituído de qualquer documentação. Além disso, como o novo objetivo do robô não necessita de comunicação semfio e não utilizará stream de vídeo, motivo principal para a utilização deste PC no projeto anterior, a equipe optou por descartar este recurso do projeto e utilizar outra placa mais simples e menor, que será descrita em detalhes na seção \ref{chap:esprob}.

A documentação disponível à equipe, produzida durante o projeto Bellator, descreve em detalhes os componentes de hardware dessa plataforma robótica, o software de controle supervisório e a camada de baixo nível, ou seja, o software da placa C8051F340\cite{BELLATOR}. Essa documentação será utilizada como referência para o reaproveitamento do projeto Bellator nesse trabalho, com exceção da documentação referente ao software de controle supervisório, que não será utilizado.

\subsection{Considerações}
A possibilidade de reaproveitamento parcial do projeto Bellator e o recebimento desse material consistiram uma importante epata nesse trabalho. A plataforma Bellator é uma opção de recurso ao apoio do estudo qualitativo proposto nesse TCC.

\input{especificacao}

\section{Lógica Fuzzy}
Essa seção tem como função descrever o que é a lógica fuzzy, como surgiu, como funciona e como projetar um sistema fuzzy.

A lógica fuzzy é baseada no trabalho de Lofti Zadeh, que propôs a teoria de conjuntos
fuzzy em 1965~\cite{FUZZYLOGIC}. Na teoria clássica de conjuntos, um elemento tem seu
grau de pertinência ao conjunto representado por uma variável booleana, ou seja, ou o elemento
pertence ao conjunto ou não pertence. Num conjunto fuzzy, no entanto, um elemento tem seu grau
de pertinência representado por um valor real no intervalo [0, 1].

Uma aplicaçao básica e clássica da lógica fuzzy é a classificação de uma variável contínua. Por exemplo,
para classificar um valor de temperatura, pode-se utilizadar um conjunto fuzzy com as variáveis
FRIO, MORNO e QUENTE. Para classificar dado valor de temperatura, pode se utilizar as classes fuzzy apresentadas
 na figura \ref{fig:fuzzyclasses}.

\begin{figure}[!htb]
    \centering
    \includegraphics{./figs/fuzzyclasses.png}
    \caption[Classificação Fuzzy]{Classificação de valores de temperatura utilizando lógica fuzzy.}
    \fonte{\cite{FUZZYLOGIC}}
    \label{fig:fuzzyclasses}
\end{figure}

A temperatura destacada na figura tem os seguintes graus de pertinência: 0.8 FRIO, 0.2 MORNO e 0 QUENTE.
É comum também associar outras variáveis linguísticas para caracterizar os valores. No caso do exemplo, uma associação
possível seria: bastante frio, levemente morno, nada quente.

Com base na saída do classificador, um sistema fuzzy pode realizar inferências. Por exemplo, caso o objetivo fosse controlar
a temperatura de uma caldeira, visando deixá-la bem quente, a observação de que está bastante frio implicaria
na necessidade da elevação da quantidade de energia disponibilizada para seu aquecimento. Conforme a temperatura aumenta, novas temperaturas seriam observadas e classificadas em graus menores de frio e maiores de morno ou quente. Estas novas classificações levam a inferências diferentes e a outras alterações na fonte de calor, até alcançar a temperatura esperada. Quanto mais próximo do nível esperado, menos calor deverá ser suprido pela fonte de calor para o sistema, neste exemplo.

As decisões tomadas pelo sistema são definidas por um conjunto de regras fuzzy, cujo formato básico é:

SE X ENTÃO Y

onde X é uma expressão contendo uma ou mais variáveis linguísticas e Y a ação a ser tomada. Retomando o exemplo da caldeira,
uma regra possível seria: SE bastante frio ENTÃO aumentar bastante o fornecimento de calor.

É evidente que os conceitos FRIO, MORNO e QUENTE são totalmente subjetivos e cada aplicação tem parâmetros e conceitos específicos, em variáveis linguísticas diferentes, tais como velocidade, distância, pressão, entre outros.
Os valores e funções utilizadas para classificar tais grandezas são determinados por quem está desenvolvendo o sistema fuzzy, com os devidos ajustes para melhor adequação à aplicação em questão. 
Da mesma forma, as decisões a serem tomadas com base nos dados classificados são definidas pelo desenvolvedor. A grande vantagem e, até mesmo, objetivo de um sistema fuzzy é proporcionar um raciocínio simples na implementação das regras de um sistema. Isso é
interessante quando se considera a adição de novos sensores e, consequentemente, novos dados. Uma simples alteração ou adição
de novas regras é o suficiente para adaptar o sistema às novas entradas. %Não é verdade, necessariamente? Novos dados/entradas -> Muitas novas regras.

Pelo fato de permitir a classificação de dados de uma forma mais flexível, em comparação com a teoria clássica de conjuntos,
os dados de entrada para um sistema fuzzy não precisam ser tão precisos, sem ruídos, já que a presença de ruídos
causa apenas pequenas variações na classificação, enquanto numa classificação binária, pouco ruído pode
ocasionar a passagem de um nível baixo para um nível alto subitamente, ao passar um limite pré-definido.

Para projetar um sistema fuzzy, o seguinte conjunto de passos pode ser seguido~\cite{FUZZYLOGICTUTORIAL}:

\begin{enumerate}
    \item Definição do que vai ser controlado, com quais critérios, qual o tipo de saída desejado;
    \item Determinação da relação entre a entrada e a saída, escolha do número de variáveis de entrada para o sistema;
    \item Utilizando a estrutura de regras da lógica fuzzy, dividir o problema principal em várias tarefas menores. Estas
    regras devem descrever o comportamento desejado conforme definido no item 1. O número e complexidade das regras depende do número de parâmetros de entrada a serem processados e do número de variáveis fuzzy associadas aos mesmos;
    \item Criação das funções de classificação, que definem os significados (comumente através de variáveis linguísticas);
    dos valores de entrada e saída. As saídas das funções de classificação serão utilizadas nas regras
    \item Criação das funções para pré e pós-processamento necessárias (para tratamento dos dados de entrada e saída);
    \item Testar o sistema, avaliar os resultados, ajustar as regras e funções de classificação. Repetir este passo;
    até obter um comportamento satisfatório.
\end{enumerate}

\subsection{Considerações}

O conceito de incerteza introduzido pela Lógica Fuzzy permite a modelagem de sistemas problemas de decisão cujas variáveis são dinâmicas e admitem vários níveis de classificação. O problema de navegação robótica
é um sistema dinâmico, pois as decisões são tomadas sob a influência de vários sensores ao mesmo tempo, e a abordagem Fuzzy é uma opção para solucioná-lo.

\section{Mapas Cognitivos Fuzzy}

Esta seção tem como objetivo explicar o que são mapas cognitivos fuzzy, também conhecidos como FCM (Fuzzy Cognitive Maps), abordando o conceito, a estrutura, as propriedades e vantagens desse modelo e apresentar um exemplo, que descreve o uso em uma situação real.

O modelo FCM é abordado na tese de doutorado de \cite{FCMENDONCA}. Mapas cognitivos são diagramas que representam ligações entre palavras, idéias, tarefas ou outros itens ligados a um conceito central, em volta do qual os elementos são dispostos radialmente e de forma intuitiva, de acordo com a importância dos conceitos. Um mapa cognitivo pode ser tratato matematicamente por meio de operações com matrizes e baseado na teoria de grafos. Desse modo, crenças ou afirmações a respeito de um domínio de conhecimento limitado são expressas por palavras ou expressões linguísticas, interligadas por relações de causa e efeito. Esse modelo propõe uma organização de idéias onde é possível predizer as consequências que essa organização implica ao universo representado, sendo considerado um modelo matemático da "estrutura de crenças". O mapa cognitivo fuzzy é gerado quando se incluem a essa estrutura incertezas através da lógica Fuzzy.

A estrutura de um mapa cognitivo fuzzy é um grafo direcionado, figura \ref{fig:fcm}, em que os valores numéricos são variáveis ou conjuntos fuzzy, os "nós" são conceitos linguísticos, representados por conjuntos fuzzy e cada "nó" é associado a outros através de conexões, a cada qual está associado um peso numérico, o qual representa uma variável fuzzy relacionado ao nível de causalidade entre os conceitos.

\begin{figure}[!htb]
    \centering
    \includegraphics{./figs/fcm.png}
    \caption[Mapa Cognitivo Fuzzy]{Exemplo de um FCM (grafo).}
    \fonte{\cite{FCMENDONCA}}
    \label{fig:fcm}
\end{figure}

O FCM descreve um sistema em termos de conceitos, onde cada conceito representa uma entidade, um estado, uma variável, ou uma característica do sistema. Os conceitos do mapa cognitivo (C1 a C5) podem ser atualizados através da interação com outros conceitos por meio das interconexões (relações causais wi,j) e com seu próprio valor. A matriz \ref{fcm-matrix} representa o peso das relações causais entre os conceitos.

\begin{equation}\label{fcm-matrix}
    wi,j=\left(
       \begin{array}{ccccc}
         0 & w12 & 0 & 0 & w15 \\
         0 & 0 & w23 & 0 & w25 \\
         0 & w32 & 0 & w34 & 0 \\
         w41 & 0 & w43 & 0 & w45 \\
         w51 & 0 & 0 & w54 & 0 \\
       \end{array}
     \right)
\end{equation}

O FCM apresenta as propriedade de elasticidade e estabilidade. A elasticidade, ou auto organização, é a capacidade de reforçar ou enfraquecer o peso das relações causais entre os conceitos, e a estabilidade é a capacidade de evoluir, estabilizando-se em um ponto fixo ou após um número máximo de iterações.

Uma vantagem do FCM é a interatividade entre os conceitos, a qual permite que um problema seja dividido em várias partes e cada parte seja representada por um mapa cognitivo modular, que é interconectado aos demais mapas do problema. Outra vantagem é que os pesos das relações causais e dos conceitos podem ser obtidos via treinamento, a partir dos dados históricos do sistema ou através de um algoritmo adaptativo, que atualiza os pesos constantemente.

Em \cite{FCMENDONCA} os mapas cognitivos Fuzzy são aplicados no controle de processos industriais. Um exemplo de aplicação é mostrado na figura \ref{fig:fcm-exemplo-planta}, na qual é ilustrado um tanque com duas válvulas de entrada para diferentes tipos de líquidos, um misturador, uma válvula de saída para o líquido misturado e um medidor de massa específica que mede a quantidade de líquido produzida. As válvulas V1 e V2 introduzem
dois líquidos diferentes. Durante a reação, um medidor G de massa específica verifica se a mistura atingiu
o ponto adequado. A válvula V3 é ativada e o produto da mistura é esvaziado.

\begin{figure}[!htb]
    \centering
    \includegraphics{./figs/fcm-exemplo-planta.png}
    \caption[Mapa Cognitivo Fuzzy]{Aplicação do FCM em processo industrial.}
    \fonte{\cite{FCMENDONCA}}
    \label{fig:fcm-exemplo-planta}
\end{figure}

Analisando-se o problema, os seguintes conceitos podem ser definidos:

\begin{itemize}
\item Conceito 1: Volume de líquido no tanque;
\item Conceito 2: Estado da válvula 1 (fechada, aberta ou parcialmente aberta);
\item Conceito 3: Estado da válvula 2 (fechada, aberta ou parcialmente aberta);
\item Conceito 4: Estado da válvula 3 (fechada, aberta ou parcialmente aberta);
\item Conceito 5: Valor medido pelo sensor G para massa específica do líquido.
\end{itemize}

Interligando-se os conceitos com as relações de causa e efeito ponderadas, obtém-se o FCM da figura \ref{fig:fcm-exemplo-fcm} para o controlador do processo.

\begin{figure}[!htb]
    \centering
    \includegraphics{./figs/fcm-exemplo-fcm.png}
    \caption[Mapa Cognitivo Fuzzy]{FCM do controlador.}
    \fonte{\cite{FCMENDONCA}}
    \label{fig:fcm-exemplo-fcm}
\end{figure}

\subsection{Considerações}
FCM é um modelo linguístico, próximo à linguagem humana, que é baseado na teoria de grafos e que permite interconectar conceitos através de relações de causa e efeito ponderadas. Essa abordagem apresenta a vantagem da modularidade, que possibilita dividir um problema complexo em diversos submodelos. Um FCM introduz a incerteza Fuzzy e tem a capacidade de integração com métodos de treinamento de inteligência artificial. O FCM é indicado para modelagem de sistemas complexos. A navegação robótica é um sistema complexo no qual vários conceitos (sensores e motores) são ativados e interagem entre si para produzir os movimentos adequados ao robô autônomo. A abordagem FCM permite modelar e mapear esses conceitos com a finalidade de implementar um algoritmo de navegação capaz de solucionar o problema.
